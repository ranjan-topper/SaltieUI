function filterPortName(){var e;e=angular.element(document.getElementById("lifestyle")).length>0?angular.element(document.getElementById("lifestyle")).scope():angular.element(document.getElementById("list")).scope(),e.$apply(function(){e.filterPortName()})}function filterCruiseLine(){var e;e=angular.element(document.getElementById("lifestyle")).length>0?angular.element(document.getElementById("lifestyle")).scope():angular.element(document.getElementById("list")).scope(),e.$apply(function(){e.filterCruiseLine()})}function filterShipName(){var e;e=angular.element(document.getElementById("lifestyle")).length>0?angular.element(document.getElementById("lifestyle")).scope():angular.element(document.getElementById("list")).scope(),e.$apply(function(){e.filterShipName()})}function AvoidSpace(e){e.value.match(/\s/g)&&(e.value=e.value.replace(/\s/g,""))}var app=angular.module("starter",["ionic","ngStorage","ngCordova","ngMessages","starter.controllers","ngIOS9UIWebViewPatch","templates"]);app.run(["$ionicPlatform","$rootScope","$state","$location","$ionicHistory","$ionicLoading","$window","$localStorage","$timeout","$ionicTabsDelegate","$ionicScrollDelegate","serviceLink",function(e,t,o,i,a,n,r,l,s,c,u,p){e.registerBackButtonAction(function(e){"app.landingPage"==o.$current.name||"startingPage"==o.$current.name?navigator.app.exitApp():e.preventDefault()},100),e.ready(function(){"undefined"!=typeof analytics?analytics.startTrackerWithId("UA-86946650-1"):console.log("Google Analytics Unavailable"),window.cordova&&window.cordova.plugins.Keyboard&&cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!1),window.StatusBar&&StatusBar.styleDefault(),window.Connection&&navigator.connection.type==Connection.NONE&&alert("No Internet Connection")}),t.travelAgentMobileNumber=p.travelAgentMobileNumber,t.triggerCall=function(e){document.location.href="tel:"+e},t.$on("loading:show",function(){n.show({template:'<img src="./img/logo1.png" width="20%"/><br><ion-spinner icon="dots" class="spinner-balanced"/>'})}),t.$on("loading:hide",function(){n.hide()}),t.$on("$stateChangeSuccess",function(e,t,o){window.fbq("track",t.name)}),void 0!=l.listGuideShown&&null!=l.listGuideShown||(l.listGuideShown=!1),t.list=[],t.firstTimeSelected=0,t.pasPageReached="pasPage",t.userFav=[],t.favourite=[],t.closePASModal=function(e){var o,a,n="",r="",p="";if(t.pasBackbtShow=!1,void 0!=e[0].liked){var d=JSON.parse(e[0].liked);angular.forEach(d,function(e,t){r+=e+","}),r=r.substring(0,r.length-1)}if(void 0!=e[1].disliked){var m=JSON.parse(e[1].disliked);angular.forEach(m,function(e,t){p+=e+","}),p=p.substring(0,p.length-1)}if(void 0!=e[2].neutral){var f=JSON.parse(e[2].neutral);angular.forEach(f,function(e,t){n+=e+","}),n=n.substring(0,n.length-1)}null!=e[3].cruisedBefore?(o=e[3].cruisedBefore,console.log(o)):o=0,null!=e[4].age?(a=e[4].age,console.log(a)):a=0,l.liked=r,l.neutral=n,l.disliked=p,l.cruisedBefore=o,l.age=a,t.noMoreCuratorItemsAvailable=!0,t.curatorListIteam=[],t.curatorListIteamTemp=[],t.noRecommendation=!1,t.startFromList=0,t.curatorListServiceCall(r,n,p,o,a),s(function(){c.$getByHandle("listTab").select(1),u.$getByHandle("CuratorlistPage").scrollTop()},100),t.flagClickedShowRecom=!0,i.path("/app/listingPage")},r.addEventListener("message",function(e){var i=e.data.task;switch(i){case"beginBt":o.go("app.curatorTellUsPage");break;case"tellusBt":t.pasPageReached="pasWhoTravel",o.go("app.curatorWhoTravelPage");break;case"whoTravel":t.pasPageReached="pasCategory",o.go("app.curatorCategoryPage");break;case"slideBack":o.go("app.curatorCategoryPage");break;case"recom":t.closePASModal(e.data.selectedItem);break;case"categoryId":t.categoryID=e.data.category_id,t.questionUrl=p.pasUrl+"CruisePAS/#questions?category_id="+e.data.category_id+"&index=0&hide-navigation=t",o.go("app.curatorQuestionPage")}t.$apply()},!0)}]);var app=angular.module("starter.controllers",[]);app.filter("capitalize",function(){return function(e,t){return e?e.replace(/([^\W_]+[^\s-]*) */g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}):""}}),app.filter("orderByCategory",function(){return function(e){var t=[];if(null!=e){Object.keys(e).forEach(function(e){"Interior"==e?t[0]=e:"Oceanview"==e?t[1]=e:"Balcony"==e?t[2]=e:"Suite"==e?t[3]=e:t[4]=e});var o=[];return angular.forEach(t,function(e){e&&o.push(e)}),o}}}),app.filter("trustUrl",["$sce",function(e){return function(t){return e.trustAsResourceUrl(t)}}]),app.filter("timeFormat",function(){return function(e){var t=e.split(":"),o=t[0]>=12?"PM":"AM";t[0]=t[0]%12,t[0]=t[0]?t[0]:12;var i=t[2].split(" ");if(i[1]){console.log(i);var a=t[0]+":"+t[1]+" "+o+" "+i[1]+" "+i[2]}else var a=t[0]+":"+t[1]+" "+o;return console.log(a),a}}),app.filter("orderByCabin",function(){return function(e){var t=[];if(null!=e){e.forEach(function(e){"Interior"==e.roomType?t[0]=e:"Oceanview"==e.roomType?t[1]=e:"Balcony"==e.roomType?t[2]=e:"Suite"==e.roomType?t[3]=e:t[4]=e});var o=[];return angular.forEach(t,function(e){e&&o.push(e)}),o}}}),app.filter("dollorCheck",function(){return function(e){return e.match(/[a-zA-Z]/)?e:"$"+e}}),app.config(["$stateProvider","$urlRouterProvider","$httpProvider","$ionicConfigProvider",function(e,t,o,i){i.tabs.style("standard").position("top"),o.interceptors.push("TokenAuthInterceptor"),o.defaults.headers["Content-Type"]="application/json",e.state("startingPage",{url:"/startingPage",templateUrl:"templates/startingPage.html",controller:"startingPageCtrl"}).state("loginChoicePage",{url:"/loginChoicePage",templateUrl:"templates/loginChoicePage.html",controller:"loginChoicePageCtrl"}).state("emailLoginPage",{url:"/emailLoginPage",templateUrl:"templates/emailLoginPage.html",controller:"emailLoginPageCtr"}).state("signUpPage",{url:"/signUpPage",templateUrl:"templates/signUpPage.html",controller:"signUpPageCtr"}).state("forgotPasswordPage",{url:"/forgotPasswordPage/:email",templateUrl:"templates/forgotPasswordPage.html",controller:"forgotPasswordPageCtr"}).state("app",{url:"/app",abstract:!0,templateUrl:"templates/menu.html",controller:"appMenuCtrl"}).state("app.landingPage",{url:"/landingPage",views:{menuContent:{templateUrl:"templates/landingPage.html",controller:"landingPageCtrl"}}}).state("app.listingPage",{url:"/listingPage",views:{menuContent:{templateUrl:"templates/listingPage.html",controller:"listingPageCtrl"}}}).state("app.myFavouritePage",{url:"/myFavouritePage",views:{menuContent:{templateUrl:"templates/myFavouritePage.html",controller:"myFavouritePageCtrl"}}}).state("app.curatorBeginPage",{url:"/curatorBeginPage",views:{menuContent:{templateUrl:"templates/curatorBeginPage.html",controller:"curatorPageCtrl"}}}).state("app.curatorWhoTravelPage",{url:"/curatorWhoTravelPage",views:{menuContent:{templateUrl:"templates/curatorWhoTravelPage.html",controller:"curatorPageCtrl"}}}).state("app.curatorCategoryPage",{url:"/curatorCategoryPage",views:{menuContent:{templateUrl:"templates/curatorCategoryPage.html",controller:"curatorPageCtrl"}}}).state("app.curatorQuestionPage",{url:"/curatorQuestionPage",views:{menuContent:{templateUrl:"templates/curatorQuestionPage.html",controller:"curatorPageCtrl"}}}).state("app.curatorTellUsPage",{url:"/curatorTellUsPage",views:{menuContent:{templateUrl:"templates/curatorTellUsPage.html",controller:"curatorPageCtrl"}}}).state("app.detailPage",{url:"/detailPage",views:{menuContent:{templateUrl:"templates/detailPage.html",controller:"detailPageCtrl"}}}).state("app.iframeBookingPage",{url:"/iframeBookingPage",views:{menuContent:{templateUrl:"templates/iframeBookingPage.html",controller:"iframeBookingPageCtrl"}}}).state("app.emailUsPage",{url:"/emailUsPage",views:{menuContent:{templateUrl:"templates/emailUsPage.html",controller:"emailUsPageCtrl"}}}).state("app.shopAndBookPage",{url:"/shopAndBookPage",views:{menuContent:{templateUrl:"templates/shopAndBookPage.html",controller:"shopAndBookPageCtrl"}}}),t.otherwise("/startingPage")}]),app.factory("TokenStorage",function(){var e="auth_token";return{store:function(t){return localStorage.setItem(e,t)},retrieve:function(){return localStorage.getItem(e)},clear:function(){return localStorage.removeItem(e)}}}),app.factory("TokenAuthInterceptor",["$q","TokenStorage","$rootScope","$injector","$timeout",function(e,t,o,i,a){return{requestError:function(e){return o.$broadcast("loading:show"),e},request:function(e){o.$broadcast("loading:show");var i=t.retrieve();return i&&(e.headers["X-Auth-Token"]=i),e.timeout=1e4,e},response:function(e){return o.$broadcast("loading:hide"),e},responseError:function(a){o.$broadcast("loading:hide"),401!==a.status&&403!==a.status||t.clear();var n=i.get("$ionicPopup");if(0===a.status){var r=e.defer(),l=n.confirm({title:"No Connectivity!",template:"Internet not available",okText:"Retry"});return l.then(function(t){if(t){var o=i.get("$http");r.resolve(o(a.config))}else r.reject(e.reject(a))}),r.promise}return e.reject(a)}}}]),app.constant("serviceLink",{shareUrl:"http://share.saltie.cruises/",pasUrl:"http://159.203.121.122:8080/",url:"http://159.203.121.122:8080/",termAndConditionVersion:"V1.0",travelAgentMobileNumber:"1 (877) 342-1332"}),app.service("FavouriteService",["$rootScope",function(e){this.addNew=function(t){for(i=0;i<e.userFav.length;i++)e.userFav[i].tripId===t&&e.userFav.splice(i,1);for(i=0;i<e.favourite.length;i++)if(e.favourite[i]===t)return void e.favourite.splice(i,1);e.favourite.push(t)}}]),app.factory("loginService",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","$rootScope","TokenStorage",function(e,t,o,i,a,n,r){function l(){var o=this;o.login=function(o,i){var l=t.defer();return e({method:"POST",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:encodeURI(i)}).success(function(e,t){200==t&&(a.Name=e.user,r.store(e.token),n.favourite1=e.favourite),l.resolve(t)}).error(function(e,t){l.resolve(t)}),l.promise},o.errors=function(e,t){400==t?i.show({title:"Error",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):500==t?i.show({title:"Error",subTitle:"Server Error",buttons:[{text:"Ok"}]}).then(function(e){}):404==t?e.email.$setValidity("emailNot",!1):403==t?alert():401==t?e.password.$setValidity("password",!1):400==t?i.show({title:"Field Missing",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):302==t?e.email.$setValidity("emailExist",!1):412==t?e.otp.$setValidity("otpMiss",!1):498==t?e.otp.$setValidity("optExp",!1):423==t?i.show({title:"Account Locked",subTitle:"Your account is locked, due to password reset. Please use forgot password and reset your password with Verification Code",buttons:[{text:"Ok"}]}).then(function(e){}):503==t?i.show({title:"Error",subTitle:"Service Down Try Later",buttons:[{text:"Ok"}]}).then(function(e){}):i.show({title:"Error",subTitle:"Oops somthing went worng !",buttons:[{text:"Ok"}]}).then(function(e){})}}return new l}]),app.factory("getCountryService",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","$rootScope",function(e,t,o,i,a,n){function r(){var o=this;o.getCountry=function(o){var i=t.defer();return e({method:"GET",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).success(function(e,t){i.resolve(e)}).error(function(e,t){}),i.promise}}return new r}]),app.factory("engageService",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","$rootScope",function(e,t,o,i,a,n){function r(){var o=this;o.submit=function(o,i){var a=t.defer();return e({method:"POST",url:o,headers:{"Content-Type":"application/x-www-form-urlencoded"},data:i}).success(function(e,t){a.resolve(t)}).error(function(e,t){a.resolve(e)}),a.promise},o.errors=function(e,t){400==t?i.show({title:"Error",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):500==t?i.show({title:"Error",subTitle:"Server Error",buttons:[{text:"Ok"}]}).then(function(e){}):404==t?e.email.$setValidity("emailNot",!1):401==t?e.password.$setValidity("password",!1):400==t?i.show({title:"Field Missing",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):302==t?e.email.$setValidity("emailExist",!1):412==t?e.otp.$setValidity("otpMiss",!1):498==t?e.otp.$setValidity("optExp",!1):423==t?i.show({title:"Account Locked",subTitle:"Your account is locked, due to password reset. Please use forgot password and reset your password with Verification Code",buttons:[{text:"Ok"}]}).then(function(e){}):503==t?i.show({title:"Error",subTitle:"Service Down Try Later",buttons:[{text:"Ok"}]}).then(function(e){}):i.show({title:"Error",subTitle:"Oops somthing went worng !",buttons:[{text:"Ok"}]}).then(function(e){})}}return new r}]),app.factory("facebookService",["$http","$q","$ionicLoading","$ionicPopup","$cordovaOauth","$localStorage","$rootScope",function(e,t,o,i,a,n,r){function l(){var o=this;o.facebook=function(o,r){var l=t.defer();return a.facebook("809674865765712",["email","read_stream","user_website","user_location","user_relationships"]).then(function(t){n.accessToken=t.access_token,n.hasOwnProperty("accessToken")===!0&&e.get("https://graph.facebook.com/v2.2/me",{params:{access_token:n.accessToken,fields:"id,name,gender,location,website,picture,relationship_status,email,first_name,last_name",format:"json"}}).then(function(e){l.resolve(e)},function(e){i.show({title:"Error",subTitle:"There was a problem getting your profile.  Check the logs for details.",buttons:[{text:"Ok"}]}).then(function(e){})})},function(e){i.show({title:"Error",subTitle:"There was a problem signing in!",buttons:[{text:"Ok"}]}).then(function(e){}),console.log(e)}),l.promise}}return new l}]),app.factory("favService",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","FavouriteService","serviceLink",function(e,t,o,i,a,n,r){function l(){var t=this;t.favorite=function(t,o){e({method:"POST",url:r.url+"SaltieApp/rest/cruise/favourite/set",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"tripId="+t}).success(function(e,i){200==i?(n.addNew(t),document.getElementById(o).src.indexOf("/img/Unfavorite.png")>=0?document.getElementById(o).src="./img/Favorite.png":document.getElementById(o).src="./img/Unfavorite.png"):alert("Error, Try again !")})}}return new l}]),app.factory("advanceFilter",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","FavouriteService","serviceLink",function(e,t,o,i,a,n,r){function l(){var o=this;o.filter=function(o){var i=t.defer();return""==o.duration&&(o.duration=""),e({method:"GET",url:r.url+"SaltieApp/rest/cruise/search?lifestyle="+o.style+"&duration="+o.duration+"&year="+o.year+"&month="+o.month+"&sortBy="+o.orderby+"&departPort="+o.ports+"&userName="+a.userName+"&shipName="+o.ship+"&cruiseLineName="+o.cruiseLine}).success(function(e){i.resolve(e)}),i.promise}}return new l}]),app.factory("themeFilter",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","FavouriteService","serviceLink",function(e,t,o,i,a,n,r){function l(){var o=this;o.theme=function(o){var i=t.defer();return e.get(r.url+"SaltieApp/rest/cruise/theme5?lifestyle="+o.style+"&duration="+o.duration+"&year="+o.year+"&month="+o.month+"&port="+o.ports+"&shipName="+o.ship+"&cruiseLineName="+o.cruiseLine).success(function(e){i.resolve(e)}),i.promise}}return new l}]),app.factory("profileGet",["$http","$q","serviceLink",function(e,t,o){function i(){var i=this;i.profile=function(){var i=t.defer();return e({method:"GET",url:o.url+"SaltieApp/rest/cruise/user/detail"}).success(function(e){i.resolve(e)}).error(function(e){i.resolve("error value")}),i.promise}}return new i}]),app.factory("profileSet",["$http","$q","$ionicLoading","$ionicPopup","$localStorage","serviceLink",function(e,t,o,i,a,n){function r(){var o=this;o.profileS=function(o){var i=t.defer();return e({method:"POST",url:n.url+"SaltieApp/rest/cruise/user/editProfile ",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:encodeURI(o)}).success(function(e,t){i.resolve(t)}).error(function(e,t){i.resolve(t)}),i.promise},o.errors=function(e,t){400==t?i.show({title:"Error",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):500==t?i.show({title:"Error",subTitle:"Server Error",buttons:[{text:"Ok"}]}).then(function(e){}):400==t?i.show({title:"Field Missing",subTitle:"Bad Request",buttons:[{text:"Ok"}]}).then(function(e){}):412==t?e.password.$setValidity("password",!1):i.show({title:"Error",subTitle:"Oops something went worng !",buttons:[{text:"Ok"}]}).then(function(e){})}}return new r}]),app.factory("detailData",["$http","$q","serviceLink","$rootScope",function(e,t,o,i){function a(){var a=this;a.detail=function(){var a=t.defer(),n=i.tripid;return e.get(o.url+"SaltieApp/rest/cruise/details/"+n+"/tripId").success(function(e){a.resolve(e)}).error(function(e){a.resolve("error value")}),a.promise}}return new a}]),app.factory("curatorList",["$http","$q","serviceLink",function(e,t,o){function i(){var i=this;i.curator=function(i,a,n,r,l,s){var c=t.defer();return e.get(o.url+"SaltiePAS/api/explore/cruises?questions_liked="+i+"&questions_disliked="+n+"&questions_neutral="+a+"&cruisedBefore="+l+"&age="+s+"&score=25&size=10&start="+r).success(function(e){c.resolve(e)}).error(function(e){c.resolve("error value")}),c.promise}}return new i}]),app.factory("discountVal",["$http","$q","serviceLink",function(e,t,o){function i(){var i=this;i.discount=function(i){var a=t.defer();return e.get(o.url+i).success(function(e){a.resolve(e)}).error(function(e){a.resolve("error value")}),a.promise}}return new i}]),app.factory("sendUrlEmailService",["$http","$q","serviceLink",function(e,t,o){function i(){var i=this;i.sendUrlEmail=function(i,a,n){var r=t.defer();return e.get(o.url+"SaltieApp/rest/cruise/email?tripId="+n+"&email="+i+"&link="+a).success(function(e,t){r.resolve(t)}).error(function(e,t){r.resolve("error value")}),r.promise}}return new i}]),app.factory("termAndConditionService",["$http","$q","serviceLink",function(e,t,o){function i(){var i=this,a={headers:{terms_conditions:o.termAndConditionVersion}};i.termAndCondition=function(){var i=t.defer();return e.get(o.url+"SaltieApp/rest/cruise/termsandcondition",a).success(function(e,t){i.resolve(e)}).error(function(e,t){i.resolve("error value")}),i.promise}}return new i}]),app.factory("termAndConditionSetService",["$http","$q","serviceLink","$rootScope",function(e,t,o,i){function a(){var i=this;i.termAndConditionSet=function(){var i=t.defer();return e({method:"POST",url:o.url+"SaltieApp/rest/cruise/termsandcondition",headers:{"Content-Type":"application/x-www-form-urlencoded",terms_conditions:o.termAndConditionVersion},data:""}).success(function(e,t){i.resolve(t)}).error(function(e,t){i.resolve("error value")}),i.promise}}return new a}]),app.controller("appMenuCtrl",["$scope","$timeout","$localStorage","$location","$http","$rootScope","$state","serviceLink","$window","TokenStorage","$ionicTabsDelegate","$ionicScrollDelegate",function(e,t,o,i,a,n,r,l,s,c,u,p){"undefined"!=typeof analytics&&analytics.trackView("App Main Controller"),e.screenWidth=screen.width,n.clickFilterFlag=0,n.applyFilterFlag="",n.filterShipPort={style:"",duration:"",year:"",month:"",ports:"",ship:"",orderby:"asc",cruiseLine:"",flag:-1},n.filterShipPort1={style:"",duration:"",year:"",month:"",ports:"",ship:"",orderby:"asc",cruiseLine:"",flag:-1},n.shipPort={lifestyle:"",duration:"",cruiseLineName:"",ports:"",shipName:"",year:"",month:""},n.backArrow={ship:0,cruiseLine:0,port:0,month1:"",month2:"",month3:"",expType:"",duration:"",orderBy:"asc"},n.preStyle="",e.myFavourite=function(){a({method:"GET",url:l.url+"SaltieApp/rest/cruise/favourite/list"}).success(function(e){n.userFav=e.tripList,i.path("/app/myFavouritePage")})},e.loginData={},e.logout=function(){0!=n.clickFilterFlag&&n.resetFilterHome(),delete o.stylelife,delete o.userName,delete o.Name,c.clear(),delete o.accessToken,delete o.emailver,r.go("startingPage",{},{reload:!0}).then(function(){setTimeout(function(){s.location.reload(!0)},500)})},e.home=function(){n.engageData="",n.TempDetail="",n.pidVivaUrl="https://book.saltie.cruises",o.stylelife="All",t(function(){u.$getByHandle("listTab").select(0),p.$getByHandle("listPage").scrollTop()},100),i.path("/app/listingPage")},e.engageClick=function(e){"Guest"==o.userName?(n.logSignClicked="engageUs",n.logsignModal.show()):(n.buttonType="Select Room Type",i.path("/app/shopAndBookPage"))}}]),app.controller("curatorPageCtrl",["$scope","$location","$rootScope","$timeout","$ionicTabsDelegate","serviceLink","$state",function(e,t,o,i,a,n,r){o.pasPageUrl=n.pasUrl+"CruisePAS/?hide-navigation=t",o.whoTravelUrl=n.pasUrl+"CruisePAS/#/whos-traveling?hide-navigation=t",o.categoryUrl=n.pasUrl+"CruisePAS/#/categories?hide-navigation=t",o.tellUsUrl=n.pasUrl+"CruisePAS/#/tell-us?hide-navigation=t",e.pasWhoTravelBack=function(){t.path("/app/curatorTellUsPage")},e.pasQuestionBack=function(){t.path("/app/curatorCategoryPage")},e.pasCategoryBack=function(){t.path("/app/curatorWhoTravelPage")},e.pasTellUsBack=function(){console.log("hi"),r.go("app.curatorBeginPage")},e.pasModalBackButton=function(){i(function(){a.$getByHandle("listTab").select(0)},100),t.path("/app/listingPage")}}]),app.controller("detailPageCtrl",["$scope","$state","$location","$rootScope","$http","$ionicLoading","$localStorage","$ionicSlideBoxDelegate","$ionicScrollDelegate","$timeout","favService","discountVal","serviceLink",function(e,t,o,a,n,r,l,s,c,u,p,d,m){"undefined"!=typeof analytics&&analytics.trackView("Detail Controller"),""==l.userName||null==l.userName?o.path("/startingPage"):(a.is_engaged="detail",a.load=!1,a.page="detail",e.openDiscountModal=function(){e.discountModal.show(),a.slideIndex=0},a.discountCall=function(){var e="SaltieApp/rest/cruise/"+a.tripid+"/offers/"+a.date+"/date";d.discount(e).then(function(e){a.discountValue=e},function(e){})},e.discountCall=function(e,t){t&&a.discountCall()},a.isFavorite=function(t){if(a.URL="./img/Unfavorite.png",null==a.favourite||void 0==a.favourite||""==a.favourite){for(i=0;i<a.userFav.length;i++)if(a.userFav[i].tripId===t){a.URL="./img/Favorite.png";break}}else for(i=0;i<e.favourite.length;i++)if(a.favourite[i]===t){a.URL="./img/Favorite.png";break}return a.URL},e.favorite=function(e,t){"Guest"==l.userName?(a.tripidfav=e,a.indexfav=t,a.logSignClicked="Favourite",a.logsignModal.show()):p.favorite(e,t)},a.show=!1,a.show1=!1,e.scrollend=function(){e.$broadcast("scroll.infiniteScrollComplete"),a.show=!0},e.enable=function(){a.show=!1},e.scrollend1=function(){e.$broadcast("scroll.infiniteScrollComplete"),a.show1=!0},e.enable1=function(){a.show1=!1},e.notSorted=function(e){return e?Object.keys(e):[]},e.scrollleft=function(){u(function(){c.$getByHandle("calendarScroll1").scrollBy(87,0,!0)},100)},e.scrollleft1=function(){u(function(){c.$getByHandle("calendarScroll").scrollBy(87,0,!0)},100)},e.browserwindow=function(){return window.open("https://ui.odysol.com/web/cruises/details.aspx?pid=677392","_blank","closebuttoncaption=back"),!1},a.moreLoad=!1,e.tripID=a.tripid,e.back=function(){a.tripid="",a.TempDetail="",a.pidVivaUrl="https://book.saltie.cruises",window.history.back(),a.engageData=a.TempDetail},a.CabinIndex=0,e.index1=0,e.isActive=function(t){return e.index1==t},e.isCabinActive=function(e){return a.CabinIndex==e},e.displayPrice=function(t,o,i){a.date=i,a.sailID=t.sailingId,a.pID=t.pid,a.priceList=t.category,e.index1=o,"NA"==a.pID?a.pidVivaUrl="https://book.saltie.cruises/Web/cruises/details.aspx?pid=874684":a.pidVivaUrl="https://book.saltie.cruises/Web/cruises/details.aspx?pid="+a.pID,a.discountCall()},a.book1=function(t){e.useragent=navigator.userAgent,o.path("/app/iframeBookingPage")},e.getEncryptedString=function(e){var t=e,o=t.length,a="";for(i=0;i<t.length;++i)a+=String.fromCharCode(o^t.charCodeAt(i));return a},a.share=function(){if("Guest"==l.userName)a.logSignClicked="share",a.logsignModal.show();else{var t=m.shareUrl+"Saltie-site/index.html?trip="+btoa(e.tripID).split("=")[0]+"&user="+btoa(l.Name).split("=")[0];window.plugins.socialsharing.share("This exciting cruise is brought to you by Saltie. The Perfect Cruise is Waiting for you!",a.detail.tripDetails.tripDesc,null,t)}},e.showVideo=function(){return window.open(a.detail.tripDetails.ship.videoUrl+"?autoplay=1","_blank","closebuttoncaption=back"),!1},e.showVideoCheck=function(){return""!=a.detail.tripDetails.ship.videoImage&&null!=a.detail.tripDetails.ship.videoImage&&"NA"!=a.detail.tripDetails.ship.videoImage},e.dateFormat=function(e,t){var o=new Date(e);return o.setDate(o.getDate()+t),o},a.emailUs=function(e){a.buttonType=e,"detail"==e&&(a.buttonType="Select Room Type"),a.logSignClicked="nextStep","Guest"==l.userName?a.logsignModal.show():o.path("/app/shopAndBookPage")})}]),app.controller("emailLoginPageCtr",["$scope","$location","$http","$ionicLoading","$localStorage","$state","loginService","serviceLink",function(e,t,o,i,a,n,r,l){var s=ionic.Platform.isIPad(),c=ionic.Platform.isIOS();1!=s&&1!=c||(document.getElementById("emaillogin").style.marginTop="20px"),"undefined"!=typeof analytics&&analytics.trackView("Email Login Controller"),""==a.userName||null==a.userName||"Guest"==a.userName?(e.close=function(){t.path("/startingPage")},e.back=function(){t.path("/loginChoicePage")},e.Login=function(o,i){if(o.$valid)if(i.password.length>5){var n=l.url+"SaltieApp/rest/cruise/user/login",s={userName:i.email,password:i.password},c="userName="+s.userName+"&password="+s.password;e.status="",r.login(n,c).then(function(n){e.status=n,200==e.status?(a.userName=i.email,t.path("app/landingPage")):r.errors(o,e.status)},function(e){})}else o.password.$setValidity("password",!1)},e.sapceCheck=function(){if(e.keypresskeycode=event.keyCode,32==e.keypresskeycode)return!1}):n.go("app.landingPage")}]),app.controller("emailUsPageCtrl",["$scope","$rootScope","$state","$location","$http","$localStorage","$ionicLoading","$ionicPopup","engageService","serviceLink","getCountryService",function(e,t,o,i,a,n,r,l,s,c,u){var p="";e.detail=angular.copy(t.TempDetail),""!=e.detail&&(p=e.detail.tripDetails.tripId,t.engageData=e.detail.tripDetails.tripId),e.pref="email",t.TempDetail="",e.personCount=[],e.personCount=[0,1,2,3,4,5],e.filterCondition={room:"Oceanview"},e.roomCat={type:"select",name:"roomType",value:t.buttonType,values:["Select Room Type","Interior","Oceanview","Balcony","Suite"]};var d=c.url+"SaltieApp/rest/cruise/countryAndState/all";u.getCountry(d).then(function(t){e.countryState=t,e.states=t[0].state,r.hide()},function(e){}),e.toggle="email",e.prefContact=function(t){e.toggle=t},t.activePrefContact=function(t){return e.toggle==t},e.gePrefContact=function(t){e.pref=t},e.user={},e.user.firstName=n.Name.split(" ")[0],e.user.lastName=n.Name.substr(n.Name.indexOf(" ")+1),n.userName.match(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)&&(e.user.email=n.userName),"undefined"!=typeof analytics&&analytics.trackView("Email Us Controller"),""!=n.userName||null!=n.userName||"Guest"!=n.userName?(e.close=function(){i.path("/startingPage")},e.submitEmailUs=function(o,a){var n=document.getElementById("kid"),u=document.getElementById("adult"),d=document.getElementById("senior"),m=n.options[n.selectedIndex].value,f=u.options[u.selectedIndex].value,g=d.options[d.selectedIndex].value,h=(document.getElementById("roomType").value,document.getElementById("country").value);if(o.$valid){var v=c.url+"SaltieApp/rest/cruise/requestQuote",y="firstName="+a.firstName+"&lastName="+a.lastName+"&email="+a.email+"&phone="+a.phone+"&tripId="+p+"&country="+h+"&state="+a.state+"&roomType="+a.roomType+"&preferedContact ="+e.pref+"&adults="+f+"&kids="+m+"&seniors="+g+"&comments="+a.comment;e.status="",s.submit(v,y).then(function(o){e.status=o,204==e.status?(l.show({title:"Thank you",subTitle:"We will get back to you soon.",buttons:[{text:"Ok"}]}).then(function(o){i.path("/app/shopAndBookPage"),t.TempDetail=e.detail}),r.hide()):l.show({title:"Error",subTitle:o.message,buttons:[{text:"Ok"}]}).then(function(e){})},function(e){})}}):o.go("app.landingPage"),e.goToListing=function(){i.path("/app/listingPage")},e.back=function(){window.history.back(),t.TempDetail=e.detail}}]),app.controller("forgotPasswordPageCtr",["$scope","$location","$state","$localStorage","$ionicPopup","$ionicLoading","$http","loginService","serviceLink","$stateParams",function(e,t,o,i,a,n,r,l,s,c){e.user=c,e.enableVerCode=!0;var u=ionic.Platform.isIPad(),p=ionic.Platform.isIOS();1!=u&&1!=p||(document.getElementById("sendemail").style.marginTop="20px"),"undefined"!=typeof analytics&&analytics.trackView("Forgot Password Controller"),""==i.userName||null==i.userName||"Guest"==i.userName?(e.close=function(){t.path("/startingPage")},e.back=function(){t.path("/emailLoginPage")},e.Sendemail=function(t,o){t.$valid&&r.get(s.url+"SaltieApp/rest/cruise/user/forgot/email?email="+o.email,{}).success(function(t,a,r,l){204==a&&(n.hide(),i.emailver=o.email,e.enableVerCode=!1)}).error(function(e,o,i,a){n.hide(),l.errors(t,o)})},e.Sendotp=function(e,o){o.password!=o.passwordc&&e.passwordc.$setValidity("dontMatch",!1),e.$valid&&r({method:"POST",url:s.url+"SaltieApp/rest/cruise/user/forgot/reset",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"email="+i.emailver+"&password="+o.password+"&code="+o.otp}).success(function(e,o,r,l){200==o&&(a.show({title:"Success",subTitle:"Your Password has been reset",buttons:[{text:"Ok"}]}).then(function(e){}),n.hide(),delete i.emailver,t.path("/emailLoginPage"))}).error(function(t,o,i,a){n.hide(),400==o?(n.hide(),e.otp.$setValidity("optExp",!1)):l.errors(e,o)})}):o.go("app.landingPage")}]),app.controller("formValidationCtrl",["$scope",function(e){e.setpassword=function(e,t){e.password.$setValidity("password",!0),e.$setPristine()},e.resetEmail=function(e){e.email.$setValidity("emailNot",!0),e.email.$setValidity("emailExist",!0),e.$setPristine()},e.setpasswordc=function(e){e.passwordc.$setValidity("dontMatch",!0),e.$setPristine()},e.setOTP=function(e){e.otp.$setValidity("otpMiss",!0),e.otp.$setValidity("otpExp",!0),e.$setPristine()},e.resetEmail=function(e){e.email.$setValidity("emailNot",!0),e.email.$setValidity("emailExist",!0),e.$setPristine()},e.resetFrom=function(e){e.$setPristine()},e.setConpassword=function(e){e.passwordc.$setValidity("dontMatch",!0),e.$setPristine()}}]),app.controller("iframeBookingPageCtrl",["$scope","$location","$rootScope","$localStorage",function(e,t,o,i){""==i.userName||null==i.userName?t.path("/startingPage"):e.back=function(){o.TempDetail=e.detail,window.history.back()}}]),app.controller("landingPageCtrl",["$scope","$location","$http","$rootScope","$localStorage","serviceLink","$timeout","$ionicTabsDelegate",function(e,t,o,i,a,n,r,l){i.TempDetail="",i.engageData="",i.buttonType="Select Room Type",i.pidVivaUrl="https://book.saltie.cruises","Guest"==a.userName?(i.loginLogout="Login",i.showMyFav=!0,i.showEngage=!0,i.hidePhBook=!1,i.showProfileSet=!0):(i.showMyFav=!1,i.showEngage=!1,i.hidePhBook=!0,i.loginLogout="Log Out"),"undefined"!=typeof analytics&&analytics.trackView("Landing Page Controller"),""==a.userName||null==a.userName?t.path("/startingPage"):(i.is_engaged="lifeStyle",i.page="lifestyle",o.get(n.url+"SaltieApp/rest/cruise/count").success(function(e){i.lifestylecount=e,i.countSailing=e.TotalSailing,i.count=i.lifestylecount[a.stylelife]}),e.viewall=function(){t.path("/app/listingPage"),r(function(){l.$getByHandle("listTab").select(0)},100)},i.floatButtonClicked=!1,i.onfloatingButton=function(e){i.floatButtonClicked=!e})}]),app.controller("listingPageCtrl",["$scope","$location","$rootScope","$localStorage","$http","$ionicLoading","$timeout","serviceLink","favService","$ionicPopup","$q","detailData","$ionicSlideBoxDelegate","curatorList","themeFilter","discountVal",function(e,t,o,a,n,r,l,s,c,u,p,d,m,f,g,h){"undefined"!=typeof analytics&&analytics.trackView("Listing Page Controller"),""==a.userName||null==a.userName?t.path("/startingPage"):(o.is_engaged="list",e.dayCount=[],o.page="list",e.favoriteId=0,e.pasBackBtFlag=0,a.listGuideShown||o.okGotItClicked||e.listScreenGuideModal.show(),void 0!=o.list&&""!=o.list||(o.noMoreItemsAvailable=!1,
o.totalDisplayed=0),void 0==o.curatorListIteamTemp||""==o.curatorListIteamTemp?(o.noRecommendation=!0,o.curatorListIteamTemp=[],o.noMoreCuratorItemsAvailable=!0):(o.noRecommendation=!1,o.noMoreCuratorItemsAvailable=!1),o.isFavourite=function(e){for(i=0;i<o.favourite.length;i++)if(o.favourite[i]==e)return!0;return!1},o.showFilter=function(){if(0==o.applyFilterFlag&&(o.clickFilterFlag=0),0==o.clickFilterFlag){for(o.filterModal.show(),o.preStyle="",o.preDuration="",o.filterShipPort={style:"All",duration:"",year:"",month:"",ports:"",ship:"",orderby:"asc",cruiseLine:"",flag:-1},document.getElementById("portName").selectedIndex=0,document.getElementById("cruiseLine").selectedIndex=0,document.getElementById("shipName").selectedIndex=0,i=0;i<o.month.length;i++)for(j=0;j<12;j++)o.month[i][j].value=!1;o.filterLifstyle(),o.clickFilterFlag=1}else o.shipPort=o.shipPort1,l(function(){o.filterShipPort.style=o.backArrow.expType,o.preStyle=o.backArrow.expType,o.preDuration=o.backArrow.duration,o.filterShipPort.duration=o.backArrow.duration,o.filterShipPort.orderby=o.backArrow.orderBy,o.resetDateMonth(o.backArrow.month1,0),o.resetDateMonth(o.backArrow.month2,1),o.resetDateMonth(o.backArrow.month3,2),document.getElementById("cruiseLine").selectedIndex=o.backArrow.cruiseLine,document.getElementById("portName").selectedIndex=o.backArrow.port,document.getElementById("shipName").selectedIndex=o.backArrow.ship},100),o.filterModal.show()},o.filterLifstyle=function(){"All"==o.filterShipPort.style&&(o.filterShipPort.style=""),g.theme(o.filterShipPort).then(function(e){o.shipPort=e,r.hide()},function(e){alert("There was a problem"),console.log(e)}),o.filterModal.show()},o.loadMore=function(){var t=p.defer();return n.get(s.url+"SaltieApp/rest/cruise/search?lifestyle="+o.filterShipPort1.style+"&duration="+o.filterShipPort1.duration+"&year="+o.filterShipPort1.year+"&month="+o.filterShipPort1.month+"&sortBy="+o.filterShipPort1.orderby+"&departPort="+o.filterShipPort1.ports+"&userName="+a.userName+"&shipName="+o.filterShipPort1.ship+"&cruiseLineName="+o.filterShipPort1.cruiseLine+"&page="+e.totalDisplayed).success(function(i){var a=i.tripList.length;o.countCruise=i.AllCount,r.hide(),0!=a?(0==o.totalDisplayed&&(o.listCount=i.AllCount,o.listCountSailing=i.TotalSailing),o.list=o.list.concat(i.tripList),o.favourite=i.favourite,o.totalDisplayed+=10,e.$broadcast("scroll.infiniteScrollComplete")):o.noMoreItemsAvailable=!0,t.resolve()}),t.promise},e.loadMoreCurator=function(){o.curatorListServiceCall(a.liked,a.neutral,a.disliked,a.cruisedBefore,a.age)},o.curatorListServiceCall=function(t,i,a,n,r){f.curator(t,i,a,o.startFromList,n,r).then(function(t){var i=t.tripList.length;o.totalCuratorList=t.totalCount,0!=i?(o.startFromList=o.startFromList+10,o.curatorListIteamTemp=o.curatorListIteamTemp.concat(t.tripList),o.curatorListIteam=angular.copy(o.curatorListIteamTemp),l(function(){e.$broadcast("scroll.infiniteScrollComplete")},500),e.$broadcast("scroll.resize"),void 0==o.curatorListIteamTemp||""==o.curatorListIteamTemp?o.noRecommendation=!0:(o.noRecommendation=!1,o.noMoreCuratorItemsAvailable=!1)):(0==o.curatorListIteamTemp.length&&(o.noRecommendation=!0),o.noMoreCuratorItemsAvailable=!0)},function(e){alert("There was a problem"),console.log(e)})},o.isFavorite=function(e){for(o.URL="./img/Unfavorite.png",i=0;i<o.favourite.length;i++)if(o.favourite[i]===e){o.URL="./img/Favorite.png";break}return o.URL},e.favorite=function(e,t){"Guest"==a.userName?(o.tripidfav=e,o.indexfav=t,o.logSignClicked="Favourite",o.logsignModal.show()):c.favorite(e,t)},e.detail=function(i){o.tripid=i,e.tripid=o.tripid,d.detail().then(function(e){o.TempDetail=e,o.detail=e,t.path("/app/detailPage"),m.update()},function(e){})},e.onFilterTabSelected=function(){e.pasBackBtFlag=0,e.filterIconShow=!0,e.filterCount=!0},e.onFilterTabDeselected=function(){e.filterCount=!1,e.filterIconShow=!1},e.onCuratorTabSelected=function(){e.pasBackBtFlag=1,e.curatorCount=!0,e.CuratorIconShow=!0,void 0==o.curatorListIteamTemp||""==o.curatorListIteamTemp?(o.noRecommendation=!0,0==o.firstTimeSelected?(e.showPASFilter(),o.firstTimeSelected=1):"pasPage"==o.pasPageReached?o.flagClickedShowRecom||t.path("/app/curatorBeginPage"):"pasWhoTravel"==o.pasPageReached?o.flagClickedShowRecom||t.path("/app/curatorWhoTravelPage"):"pasCategory"==o.pasPageReached&&(o.flagClickedShowRecom||t.path("/app/curatorCategoryPage"))):o.noRecommendation=!1},e.onCuratorTabDeselected=function(){e.curatorCount=!1,e.CuratorIconShow=!1},e.back=function(){1==e.pasBackBtFlag&&1==o.noRecommendation?t.path("/app/curatorCategoryPage"):1==e.pasBackBtFlag&&0==o.noRecommendation?t.path("/app/curatorCategoryPage"):(o.page="lifestyle",t.path("/app/landingPage"))},e.showPASFilter=function(){0==o.firstTimeSelected?t.path("/app/curatorBeginPage"):e.showCategoryPage()},e.showCategoryPage=function(){t.path("/app/curatorCategoryPage")},e.discountCall=function(t){var o="SaltieApp/rest/cruise/"+t+"/offers";h.discount(o).then(function(t){e.showDiscountPopup(t)},function(e){})},e.showDiscountPopup=function(t){e.discountData=t;var o=u.show({templateUrl:"templates/popupPage/listDiscountPopUp.html",title:"Offers",scope:e,buttons:[{text:"Ok",onTap:function(e){o.close()}}]})})}]),app.controller("loginChoicePageCtrl",["$scope","$state","$localStorage","$location","$ionicLoading","facebookService","loginService","$ionicPopup","serviceLink","$rootScope",function(e,t,o,i,a,n,r,l,s,c){var u=ionic.Platform.isIPad(),p=ionic.Platform.isIOS();1!=u&&1!=p||(document.getElementById("login").style.marginTop="20px"),"undefined"!=typeof analytics&&analytics.trackView("Login choice page Controller"),""==o.userName||null==o.userName||"Guest"==o.userName?(e.email=function(){i.path("/emailLoginPage")},e.close=function(){i.path("/startingPage")},e.login=function(){n.facebook().then(function(t){e.profileData=t.data;var n=s.url+"SaltieApp/rest/cruise/user/registration/fb",u="userName="+t.data.id+"&token="+t.data.id+"&firstName="+e.profileData.first_name+"&lastName="+e.profileData.last_name;r.login(n,u).then(function(n){200==n?(o.Name=e.profileData.first_name+" "+e.profileData.last_name,c.loginLogout="Log out",c.showMyFav=!1,c.showEngage=!1,c.hidePhBook=!0,c.showProfileSet=!0,o.userName=t.data.id,i.path("/app/landingPage"),a.hide()):(l.show({title:"Error",subTitle:"Oops somthing went worng !",buttons:[{text:"Ok"}]}).then(function(e){}),a.hide())})},function(e){alert("There was a problem getting your profile.  Check the logs for details."),console.log(e)})}):t.go("app.landingPage")}]),app.controller("loginSignUpCtrl",["$scope","$location","$http","$rootScope","$localStorage","$ionicLoading","serviceLink","$ionicPopup","loginService","favService","facebookService",function(e,t,o,i,a,n,r,l,s,c,u){i.hideForm=!0,i.toggle=function(){i.hideForm=e.hideForm===!1},i.facebookLogin=function(){u.facebook().then(function(o){e.profileData=o.data;var u=r.url+"SaltieApp/rest/cruise/user/registration/fb",p="userName="+o.data.id+"&token="+o.data.id+"&firstName="+e.profileData.first_name+"&lastName="+e.profileData.last_name;s.login(u,p).then(function(r){200==r?(a.Name=e.profileData.first_name+" "+e.profileData.last_name,a.userName=o.data.id,i.loginLogout="Log out",i.showMyFav=!1,i.showEngage=!1,i.hidePhBook=!0,i.showProfileSet=!0,"Favourite"==i.logSignClicked?(i.logsignModal.hide(),0==i.isFavourite(i.tripidfav)&&c.favorite(i.tripidfav,i.indexfav)):"nextStep"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):"engageUs"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):(i.logsignModal.hide(),i.share())):(l.show({title:"Error",subTitle:"Oops somthing went worng !",buttons:[{text:"Ok"}]}).then(function(e){}),n.hide())})},function(e){alert("There was a problem signing in!  See the console for logs"),console.log(e)})},i.signUp=function(o,n){if(o.$valid){var l=r.url+"SaltieApp/rest/cruise/user/registration/app",u="userName="+n.email+"&password="+n.password+"&firstName="+n.firstName+"&lastName="+n.lastName;e.status="",s.login(l,u).then(function(r){e.status=r,200==e.status?(i.loginLogout="Log out",i.showMyFav=!1,i.showEngage=!1,i.hidePhBook=!0,i.showProfileSet=!1,a.userName=n.email,"Favourite"==i.logSignClicked?(i.logsignModal.hide(),c.favorite(i.tripidfav,i.indexfav)):"nextStep"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):"engageUs"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):(i.logsignModal.hide(),i.share())):s.errors(o,e.status)},function(e){})}},i.Login=function(o,n){if(o.$valid)if(n.password1.length>5){var l=r.url+"SaltieApp/rest/cruise/user/login",u={userName:n.email1,password:n.password1},p="userName="+u.userName+"&password="+u.password;e.status="",s.login(l,p).then(function(r){e.status=r,200==e.status?(i.loginLogout="Log out",i.showMyFav=!1,i.showEngage=!1,i.hidePhBook=!0,i.showProfileSet=!1,a.userName=n.email1,"Favourite"==i.logSignClicked?(i.logsignModal.hide(),null==i.favourite1&&""==i.favourite1||(i.favourite=angular.copy(i.favourite1)),0==i.isFavourite(i.tripidfav)&&c.favorite(i.tripidfav,i.indexfav)):"nextStep"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):"engageUs"==i.logSignClicked?(i.logsignModal.hide(),t.path("/app/shopAndBookPage")):(i.logsignModal.hide(),i.share())):s.errors(o,e.status)},function(e){})}else o.password.$setValidity("password",!1)}}]),app.controller("modalCtrl",["$scope","$anchorScroll","$location","$http","$rootScope","$ionicScrollDelegate","$localStorage","$ionicLoading","serviceLink","$ionicPopup","$ionicModal","$ionicSlideBoxDelegate","$timeout","profileSet","profileGet","$sce","$filter","termAndConditionSetService",function(e,t,o,i,a,n,r,l,s,c,u,p,d,m,f,g,h,v){a.linkUrl=s.url,e.readyBookDisable=!1,a.clickedFromMenu=!0,u.fromTemplateUrl("templates/modalPage/aboutModal.html",{scope:e}).then(function(t){e.aboutModal=t}),u.fromTemplateUrl("templates/modalPage/listScreenGuideModal.html",{scope:e}).then(function(t){e.listScreenGuideModal=t}),u.fromTemplateUrl("templates/modalPage/profileSettingModal.html",{scope:e}).then(function(t){e.profileSet=t}),u.fromTemplateUrl("templates/modalPage/phoneModal.html",{scope:e}).then(function(t){e.phoneModal=t}),u.fromTemplateUrl("templates/modalPage/faqModal.html",{scope:e}).then(function(t){e.faqModal=t}),u.fromTemplateUrl("templates/modalPage/termModal.html",{scope:e}).then(function(t){e.termAndCondition=t}),u.fromTemplateUrl("templates/modalPage/filterLifestyleModal.html",{scope:a}).then(function(e){a.filterModal=e}),u.fromTemplateUrl("templates/modalPage/loginSignup.html",{scope:a}).then(function(e){a.logsignModal=e}),u.fromTemplateUrl("templates/modalPage/cabinSlideModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.modal=t}),u.fromTemplateUrl("templates/modalPage/discountModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.discountModal=t}),u.fromTemplateUrl("templates/modalPage/activityVideoModal.html",{scope:e,hardwareBackButtonClose:!1}).then(function(t){e.showVideo=t}),u.fromTemplateUrl("templates/modalPage/shipActivityModal.html",{scope:e}).then(function(t){e.modal2=t}),u.fromTemplateUrl("templates/modalPage/privacyPolicyModal.html",{scope:e}).then(function(t){e.privacyPolicyModal=t}),a.closeLoginSign=function(){a.logsignModal.remove(),a.hideForm=!0,u.fromTemplateUrl("templates/modalPage/loginSignup.html",{scope:a}).then(function(e){a.logsignModal=e})},e.video=function(){a.videoURL=a.detail.tripDetails.ship.videoUrl+"?autoplay=1&rel=0",e.showVideo.show()},e.closeVidio=function(){e.showVideo.remove(),u.fromTemplateUrl("templates/modalPage/activityVideoModal.html",{scope:e,hardwareBackButtonClose:!1}).then(function(t){e.showVideo=t})},e.trustSrc=function(e){return g.trustAsResourceUrl(e)},e.activityModal=function(t){p.$getByHandle("detailSlide").stop(),l.show({template:'<img src="./img/logo1.png" width="20%"/><br><ion-spinner icon="dots" class="spinner-balanced"/>'}),e.modal2.show(),d(function(){p.$getByHandle("activity").update(),p.$getByHandle("activity").slide(t),l.hide()},500)},e.closeModal=function(){e.modal2.hide(),p.$getByHandle("detailSlide").start()},e.displayCabin=function(t,o,i){a.CabinIndex=o,e.category=t,e.cabinInfo=e.detail.tripDetails.ship.cabinType,e.price=i,"Sold Out"==e.price&&(e.readyBookDisable=!0),e.modal.show(),d(function(){p.$getByHandle("cabinType").update(),p.$getByHandle("cabinType").slide(o)},300)},e.setPrice=function(e,t,o){0==t&&(a.pID=e.pid,a.sailID=e.sailingId,a.priceList=e.category,"NA"==a.pID?a.pidVivaUrl="https://book.saltie.cruises/Web/cruises/details.aspx?pid=734348":a.pidVivaUrl="https://book.saltie.cruises/Web/cruises/details.aspx?pid="+a.pID,a.date=o)},e.cabinTypeClose=function(){e.modal.hide(),e.readyBookDisable=!1},e.cabinSlideChanged=function(t){e.readyBookDisable=!1;var o=h("orderByCategory")(a.priceList);e.category=o[t],e.price=a.priceList[e.category][0],"Sold Out"==e.price&&(e.readyBookDisable=!0)},e.aboutClick=function(){e.aboutModal.show()},e.phoneClick=function(){e.phoneModal.show()},e.faqClick=function(){e.faqModal.show()},e.scrollMe=function(e){o.hash(e);var t=n.$getByHandle("content");t.anchorScroll()},e.closeFAQ=function(){e.faqModal.remove(),u.fromTemplateUrl("templates/modalPage/faqModal.html",{scope:e}).then(function(t){e.faqModal=t})},e.privacyPolicyClick=function(){e.privacyPolicyModal.show()},e.closePrivacyPolicy=function(){e.privacyPolicyModal.remove(),u.fromTemplateUrl("templates/modalPage/privacyPolicyModal.html",{scope:e}).then(function(t){e.privacyPolicyModal=t})},e.termClick=function(){a.clickedFromMenu=!0,e.termAndCondition.show()},e.closeTermsCond=function(){e.termAndCondition.remove(),u.fromTemplateUrl("templates/modalPage/termModal.html",{scope:e}).then(function(t){e.termAndCondition=t})},e.profileSetting=function(){e.buttonName="Change Password",e.changePasshide=!0,e.passwordValidity=0,f.profile().then(function(t){e.user=t},function(e){}),e.profileSet.show()},e.closeProfile=function(){e.profileSet.remove(),u.fromTemplateUrl("templates/modalPage/profileSettingModal.html",{scope:e}).then(function(t){e.profileSet=t})},e.editProfile=function(t,o){if(o.newPassword!=o.passwordc&&t.passwordc.$setValidity("dontMatch",!1),0==e.passwordValidity&&(t.password.$setValidity("password",!0),t.passwordc.$setValidity("dontMatch",!0),t.newPassword.$setValidity("required",!0),t.passwordc.$setValidity("required",!0)),t.$valid)if(o.oldPassword.length>5){""!=o.newPassword&&void 0!=o.newPassword||(o.newPassword="");var i="userName="+r.userName+"&firstName="+o.firstName+"&lastName="+o.lastName+"&oldPassword="+o.oldPassword+"&newPassword="+o.newPassword;e.status="",m.profileS(i).then(function(i){e.status=i,200==e.status?(c.show({title:"Success",subTitle:"Your Profile is Updated",buttons:[{text:"Ok"}]}).then(function(e){}),r.Name=o.firstName,e.closeProfile()):m.errors(t,e.status)},function(e){})}else t.password.$setValidity("password",!1)},e.showPassfield=function(t,o){0==e.passwordValidity?(e.buttonName="Back",e.changePasshide=!1,t.newPassword.$setValidity("required",!1),t.passwordc.$setValidity("required",!1),t.$setPristine(),e.passwordValidity=1):(e.changePasshide=!0,e.buttonName="Change Password",e.passwordValidity=0,o.newPassword="",o.passwordc="")},e.discountChanged=function(e){a.slideIndex=e},e.previous=function(){p.$getByHandle("discountType").previous()},e.discountModalRemove=function(){e.discountModal.remove(),u.fromTemplateUrl("templates/modalPage/discountModal.html",{scope:e,animation:"slide-in-up"}).then(function(t){e.discountModal=t})},e.termCondAccept=function(){v.termAndConditionSet().then(function(t){200==t?(a.termCondAccepted=!0,o.path("/app/iframeBookingPage"),e.termAndCondition.remove(),u.fromTemplateUrl("templates/modalPage/termModal.html",{scope:e}).then(function(t){e.termAndCondition=t})):a.termCondAccepted=!1},function(e){})},e.termCondDecline=function(){e.termAndCondition.remove(),a.clickedFromMenu=!0,u.fromTemplateUrl("templates/modalPage/termModal.html",{scope:e}).then(function(t){e.termAndCondition=t}),o.path("/app/shopAndBookPage")},e.isCheckedDontShow=!1,e.checkToggle=r.listGuideShown,e.updateLocalStorage=function(e){r.listGuideShown=e},e.listScreenGuideRemove=function(){e.listScreenGuideModal.remove(),a.okGotItClicked=!0,u.fromTemplateUrl("templates/modalPage/listScreenGuideModal.html",{scope:e}).then(function(t){e.listScreenGuideModal=t})}}]),app.controller("myFavouritePageCtrl",["$scope","$location","$ionicModal","$rootScope","$http","$ionicLoading","$localStorage","FavouriteService","serviceLink","detailData","$ionicSlideBoxDelegate","discountVal","$ionicPopup",function(e,t,o,i,a,n,r,l,s,c,u,p,d){"undefined"!=typeof analytics&&analytics.trackView("My Favourite Controller"),""==r.userName||null==r.userName?t.path("/startingPage"):(e.detail=function(o){i.tripid=o,e.tripid=i.tripid,c.detail().then(function(e){i.TempDetail=e,i.detail=e,t.path("/app/detailPage"),u.update()},function(e){})},e.myFav=function(e){a({method:"POST",url:s.url+"SaltieApp/rest/cruise/favourite/set",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:"tripId="+e}).success(function(t,o){200==o?(l.addNew(e),n.hide()):alert("error")})},e.back=function(){window.history.back()},e.discountCall=function(t){var o="SaltieApp/rest/cruise/"+t+"/offers";p.discount(o).then(function(t){e.showDiscountPopup(t)},function(e){})},e.showDiscountPopup=function(t){e.discountData=t;var o=d.show({templateUrl:"templates/popupPage/listDiscountPopUp.html",title:"Offers",scope:e,buttons:[{text:"Ok",onTap:function(e){o.close()}}]})})}]),app.controller("saltieFilterCtrl",["$scope","$location","$http","$rootScope","$ionicLoading","$ionicPopup","advanceFilter","$ionicScrollDelegate","$timeout",function(e,t,o,a,n,r,l,s,c){a.orderBy="asc",a.month=[],a.month[0]=[{month:"Jan",value:!1,number:1},{month:"Feb",value:!1,number:2},{month:"Mar",value:!1,number:3},{month:"Apr",value:!1,number:4},{month:"May",value:!1,number:5},{month:"Jun",value:!1,number:6},{month:"Jul",value:!1,number:7},{month:"Aug",value:!1,number:8},{month:"Sep",value:!1,number:9},{month:"Oct",value:!1,number:10},{month:"Nov",value:!1,number:11},{month:"Dec",value:!1,number:12}],a.month[1]=[{month:"Jan",value:!1,number:1},{month:"Feb",value:!1,number:2},{month:"Mar",value:!1,number:3},{month:"Apr",value:!1,number:4},{month:"May",value:!1,number:5},{month:"Jun",value:!1,number:6},{month:"Jul",value:!1,number:7},{month:"Aug",value:!1,number:8},{month:"Sep",value:!1,number:9},{month:"Oct",value:!1,number:10},{month:"Nov",value:!1,number:11},{month:"Dec",value:!1,number:12}],a.month[2]=[{month:"Jan",value:!1,number:1,id:"mon1"},{month:"Feb",value:!1,number:2,id:"mon2"},{month:"Mar",value:!1,number:3,id:"mon3"},{month:"Apr",value:!1,number:4,id:"mon4"},{month:"May",value:!1,number:5,id:"mon5"},{month:"Jun",value:!1,number:6,id:"mon6"},{month:"Jul",value:!1,number:7,id:"mon7"},{month:"Aug",value:!1,number:8,id:"mon8"},{month:"Sep",value:!1,number:9,id:"mon9"},{month:"Oct",value:!1,number:10,id:"mon10"},{month:"Nov",value:!1,number:11,id:"mon11"},{month:"Dec",value:!1,number:12,id:"mon12"}],a.yearColor="",a.selectedYear=[{year:"",value:[]},{year:"",value:[]},{year:"",value:[]}],a.year=[],a.year[0]=(new Date).getFullYear(),a.year[1]=(new Date).getFullYear()+1,a.year[2]=(new Date).getFullYear()+2,a.lifestyle=function(e){a.preStyle==e?(a.filterShipPort.style="All",a.preStyle=""):(a.filterShipPort.style=e,a.preStyle=e),a.filterShipPort.flag=0,a.filterLifstyle()},a.isLifestyleActive=function(e){return a.filterShipPort.style==e},a.disableLife=function(e){for(i=0;i<a.shipPort.lifestyle.length;i++)if(a.shipPort.lifestyle[i]==e)return!1;return!0},a.duration=function(e){a.preDuration==e?(a.filterShipPort.duration="",a.preDuration=""):(a.filterShipPort.duration=e,a.preDuration=e),a.filterShipPort.flag=1,a.filterLifstyle()},a.isDurationActive=function(e){return a.filterShipPort.duration==e},a.disableDuration=function(e){for(i=0;i<a.shipPort.duration.length;i++)if(a.shipPort.duration[i]==e)return!1;return!0},a.filterCruiseLine=function(){var e=document.getElementById("cruiseLine"),t=e.options[e.selectedIndex].value;a.filterShipPort.cruiseLine=t,a.filterShipPort.flag=2,a.filterLifstyle()},a.filterPortName=function(){var e=document.getElementById("portName"),t=e.options[e.selectedIndex].value;a.filterShipPort.ports=t,a.filterShipPort.flag=3,a.filterLifstyle()},a.filterShipName=function(){var e=document.getElementById("shipName"),t=e.options[e.selectedIndex].value;a.filterShipPort.ship=t,a.filterShipPort.flag=4,a.filterLifstyle()},a.disableCheck=function(e,t){var o=new Date,i=0;return t==o.getFullYear()+1&&(i=1),t==o.getFullYear()+2&&(i=2),""==a.shipPort.month||""==a.shipPort.month[t]?void 0:a.shipPort.year.indexOf(t.toString())>=0?a.shipPort.month[t].indexOf(parseInt(e))<0?(a.month[i][parseInt(e)-1].value=!1,a.disableColor=!0,!0):(a.disableColor=!1,!1):(a.month[i][parseInt(e)-1].value=!1,a.disableColor=!0,!0)},a.commonMonthYear=function(e){var t="";return e.forEach(function(e){e.value&&(t&&(t+="-"),t+=e.number)}),t},a.resetDateMonth=function(e,t){if(null!=e){for(j=0;j<12;j++)a.month[t][j].value=!1;var o=e.split("-");if(""!=o)for(i=0;i<o.length;i++){var n=o[i]-1;a.month[t][n].value=!0}}},a.monthSelect=function(){var e="",t="",o=a.commonMonthYear(a.month[0]);o&&(e=a.year[0]),t=o;var i=a.commonMonthYear(a.month[1]);i&&(e&&(e+="-",t+="@"),t+=i,e+=a.year[1]);var n=a.commonMonthYear(a.month[2]);n&&(e&&(e+="-",t+="@"),t+=n,e+=a.year[2]),a.filterShipPort.month=t,a.filterShipPort.year=e,a.filterLifstyle()},a.isYearActive=function(e){return a.yearColor==e},a.nextClick=function(e){a.myActiveSlide=e},a.perYear=function(e,t){a.myActiveSlide=t},a.slideHasChanged=function(e){a.myActiveSlide=e},a.set_color=function(e,t){return 0==t?{color:"#339fa6"}:1==t?{color:"#9c867a"}:2==t?{color:"#00232d"}:void 0},a.applyFilter=function(){a.applyFilterFlag=1,a.list=[],a.noMoreItemsAvailable=!1,s.$getByHandle("listPagescroller").scrollTop();var e="",o="",i=a.commonMonthYear(a.month[0]);i&&(e=a.year[0]),o=i;var c=a.commonMonthYear(a.month[1]);c&&(e&&(e+="-",o+="@"),o+=c,e+=a.year[1]);var u=a.commonMonthYear(a.month[2]);u&&(e&&(e+="-",o+="@"),o+=u,e+=a.year[2]),a.filterShipPort.month=o,a.filterShipPort.year=e;var p=document.getElementById("portName"),d=document.getElementById("shipName"),m=document.getElementById("cruiseLine"),f=m.options[m.selectedIndex].value,g=p.options[p.selectedIndex].value,h=d.options[d.selectedIndex].value;a.filterShipPort.ship=h,a.filterShipPort.ports=g,a.filterShipPort.cruiseLine=f,a.backArrow.expType=angular.copy(a.filterShipPort.style),a.backArrow.duration=angular.copy(a.filterShipPort.duration),a.backArrow.orderBy=angular.copy(a.filterShipPort.orderby),a.shipPort1=angular.copy(a.shipPort),a.backArrow.ship=d.selectedIndex,a.backArrow.cruiseLine=m.selectedIndex,a.backArrow.port=p.selectedIndex,a.backArrow.month1=angular.copy(i),a.backArrow.month2=angular.copy(c),a.backArrow.month3=angular.copy(u),a.filterShipPort1=angular.copy(a.filterShipPort),a.totalDisplayed=0,a.countCruise="",l.filter(a.filterShipPort1).then(function(e){a.countCruise=e.AllCount,0==a.countCruise?(a.count=0,r.show({title:"For the selected month there is no cruise available",subTitle:"Please try different months",buttons:[{text:"Ok"}]}).then(function(e){})):(a.filterModal.hide(),t.path("/app/listingPage")),n.hide()},function(e){alert("There was a problem"),console.log(e)})},a.sortBy=function(e){a.filterShipPort.orderby=e,a.orderBy=e},a.isSortByActive=function(e){return a.filterShipPort.orderby==e},a.resetFilterHome=function(){for(a.clickFilterFlag=0,a.preStyle="",a.preDuration="",a.filterShipPort={style:"All",duration:"",year:"",month:"",ports:"",ship:"",orderby:"asc",cruiseLine:"",flag:-1},document.getElementById("portName").selectedIndex=0,document.getElementById("cruiseLine").selectedIndex=0,document.getElementById("shipName").selectedIndex=0,i=0;i<a.month.length;i++)for(j=0;j<12;j++)a.month[i][j].value=!1},a.resetFilter=function(){a.resetFilterHome(),a.showFilter()}}]),app.controller("shopAndBookPageCtrl",["$scope","$location","$http","$rootScope","$localStorage","$ionicPopup","sendUrlEmailService","termAndConditionService",function(e,t,o,i,a,n,r,l){"undefined"!=typeof analytics&&analytics.trackView("Shop And Book Page Controller"),e.engageUser=function(){t.path("/app/emailUsPage")},l.termAndCondition().then(function(e){e.termsAccepted?i.termCondAccepted=!0:i.termCondAccepted=!1},function(e){}),e.bookOnline=function(){e.detail=angular.copy(i.TempDetail),e.name=a.Name.split(" ")[0],void 0==e.detail||""==e.detail||null==e.detail?e.is_showBookingPopup=!0:i.termCondAccepted?(e.is_showBookingPopup=!1,t.path("/app/iframeBookingPage")):(i.clickedFromMenu=!1,e.termAndCondition.show(),e.is_showBookingPopup=!1)},e.back=function(){window.history.back()},e.goToList=function(){e.is_showBookingPopup=!1,t.path("/app/listingPage")},e.closePopup=function(){e.is_showBookingPopup=!1},e.urlBookWeb=i.pidVivaUrl;var s=/\w+([-+.']\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/,c=a.userName;s.test(c)?e.emailBook=a.userName:e.emailBook="",e.bookOnlineWeb=function(){var t=n.show({templateUrl:"templates/popupPage/sendEmailUrlPopUp.html",scope:e});e.noThanks=function(){t.close()},e.okSendUrl=function(e,o){e.$valid&&(void 0==i.tripid&&(i.tripid=""),""==i.TempDetail&&(i.pidVivaUrl="https://book.saltie.cruises/"),r.sendUrlEmail(o,i.pidVivaUrl,i.tripid).then(function(e){204==e&&(t.close(),n.show({title:"Success",subTitle:"Please Check your mail for website Url",buttons:[{text:"Ok"}]}).then(function(e){}))},function(e){alert("There was a problem"),console.log(e)}))}}}]),app.controller("signUpPageCtr",["$scope","$state","$location","$localStorage","$ionicLoading","loginService","serviceLink",function(e,t,o,i,a,n,r){var l=ionic.Platform.isIPad(),s=ionic.Platform.isIOS();1!=l&&1!=s||(document.getElementById("signuphome").style.marginTop="20px"),"undefined"!=typeof analytics&&analytics.trackView("Sign Up Page Controller"),""==i.userName||null==i.userName||"Guest"==i.userName?(e.close=function(){o.path("/startingPage")},e.signUp=function(t,i){if(t.$valid){var l=r.url+"SaltieApp/rest/cruise/user/registration/app",s="userName="+i.email+"&password="+i.password+"&firstName="+i.firstName+"&lastName="+i.lastName;e.status="",n.login(l,s).then(function(i){e.status=i,200==e.status?(o.path("/emailLoginPage"),a.hide()):n.errors(t,e.status)},function(e){})}}):t.go("app.landingPage")}]),app.controller("startingPageCtrl",["$scope","$location","$state","$localStorage","$timeout","$rootScope","serviceLink",function(e,t,o,i,a,n,r){if(n.linkUrl=r.url,"undefined"!=typeof analytics&&analytics.trackView("Starting Page Controller"),""==i.userName||null==i.userName||"Guest"==i.userName){i.stylelife="All";var l=a(function(){e.swipetohome()},1e4);e.swipetohome=function(){a.cancel(l),t.path("/app/landingPage")},e.signUp=function(){a.cancel(l),t.path("/signUpPage")},e.login=function(){a.cancel(l),t.path("/loginChoicePage")},i.userName="Guest",e.welcomeBack=!1}else{e.name=i.Name,e.welcomeBack=!0,t.path("/startingPage");var l=a(function(){e.swipetohome()},1e4);e.swipetohome=function(){a.cancel(l),t.path("/app/landingPage")}}}]);